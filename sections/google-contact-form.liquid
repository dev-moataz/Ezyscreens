
<style>
.premium-inquiry-section {
  background-color: #F8F6F4;
  padding: 60px 0px;
}
.contact-container{
  position: relative;
  display: flex;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 60px;
}

.premium-inquiry-text {
  flex: 1 1 45%;
    z-index: 5;
}

.premium-inquiry-text h2 {
}


.premium-inquiry-form-wrapper {
  flex: 1 1 45%;
  background: white;
  padding: 30px;
  border-radius: 10px;
    border: 1px solid #D6CEC2;
}

.premium-inquiry-form-wrapper form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

  .contact-container .bg-image {
    position: absolute;
    bottom: -120px;
    left: -150px;
  }
  @media screen and (max-width: 749px) {
    .contact-container .bg-image {
        width: 300px;
        height: auto;
    }
    .contact-container{
      gap: 10px;
    }
    .premium-inquiry-form-wrapper{
      
    z-index: 2;
    padding: 20px;
    }
    .google_field__input--select {
    background-image: linear-gradient(43deg, transparent 50%, gray 50%), linear-gradient(138deg, gray 50%, transparent 50%);
    background-position: calc(100% - 21px) calc(1.2em + 2px), calc(100% - 14px) calc(1.2em + 2px);
    }
  }
  
</style>
<div class="premium-inquiry-section">
  <div class="page-width">
    <div class="contact-container">
      {% comment %} bg image {% endcomment %}
      <img src="{{ section.settings.bg_image | image_url: width: 400 }}" alt="Ezyscreens logo" class="bg-image">

      <div class="premium-inquiry-text">
        <p  class="tagline "style="color:#198A28; margin-bottom: 0 !important;">{{ section.settings.tagline }}</p>
        <h2>{{ section.settings.heading }}</h2>
        <div>{{ section.settings.subtext }}</div>
      </div>
      <div class="premium-inquiry-form-wrapper">

        {% form 'contact', id: 'new_linked_with_sheets' %}

          {% if form.posted_successfully? %}
            <p class="success-message">Your message was sent successfully, you'll hear from us soon!</p>
          {% endif %}

          {% if form.errors %}
            <p class="error-message">Oops, looks like something something went wrong.</p>
          {% endif %}

          {% unless form.posted_successfully? %}

            <div class="google_field">
              <label class="google_field__label" for="contact[name]" >Full Name*</label>
              <input class="google_field__input {% if form.errors contains 'author' %}error{% endif %}" required type="text" placeholder="John Doe" name="contact[name]" id="contact[name]">
            </div>
            <div class="no-margin grid grid--1-col-tablet-down grid--2-col-desktop ">
              <div class="google_field grid__item">
                <label class="google_field__label" for="contact[email]" >Email*</label>
                <input class="google_field__input {% if form.errors contains 'email' %}error{% endif %}" required type="email" placeholder="john.doe@gmail.com" name="contact[email]" id="contact[email]">
              </div>


              <div class="google_field grid__item">
                <label class="google_field__label" for="contact[number]" >Phone Number*</label>
                <input class="google_field__input " required type="text" placeholder="0412345678" name="contact[number]" id="contact[number]">
              </div>            
            </div>


            <div class="google_field">
              <label class="google_field__label" for="reason">Reason For Your Inquiry* </label>
              <select  class="google_field__input google_field__input--select " required name="contact[reason]" id="reason" >
                <option value="General Inquiry">General Inquiry</option>
                <option value="Installation Quotes">Installation Quotes</option>
                <option value="Technicians Advice">Technicians Advice</option>
                <option value="Warranty Claims">Warranty Claims</option>
              </select>
            </div>

            <div class="show-warranty">
              <label class="google_field__label" for="order">Enter your order number </label>
              <input class="google_field__input"  type="text"  id="order" name="contact[order]" >
            </div>
            <div class="show-installation">
              <label class="google_field__label" for="suburb">Enter your suburb (South East Queensland Only)</label>
              <input class="google_field__input" type="text"  id="suburb" name="contact[suburb]" >
            </div>

            <div class="google_field">
              <label class="google_field__label" for="" >Message*</label>
              <textarea class="google_field__input google_field__input-textarea {% if form.errors contains 'body' %}error{% endif %}" placeholder="Type your message here.." required name="contact[body]" rows="6"></textarea>
            </div>

            <div class="google_field">
              <input type="hidden" class="spam-check" value="">
              <input class="button button--primary button--full-width" type="submit" value="SUBMIT YOUR INQUIRY">
            </div>
          {% endunless %}

        {% endform %}

      </div>    
    </div>
  </div>

</div>
<script>

  document.querySelector('select[name="contact[reason]"]').addEventListener('change', function(e) {
      let reasonsSelector = e.target;
      let form = reasonsSelector.closest('form#new_linked_with_sheets');
      if (reasonsSelector.value == 'Warranty Claims'){
        form.classList.add('form-warranty');
        form.classList.remove('form-installation');
        
        form.querySelector('[name="contact[order]"]').value = "";
        form.querySelector('[name="contact[suburb]"]').value = "";
      }else if(reasonsSelector.value == 'Installation Quotes'){
        form.classList.remove('form-warranty');
        form.classList.add('form-installation');
        
        form.querySelector('[name="contact[order]"]').value = "";
        form.querySelector('[name="contact[suburb]"]').value = "";
      }else{
        form.classList.remove('form-warranty');
        form.classList.remove('form-installation');
        form.querySelector('[name="contact[order]"]').value = "";
        form.querySelector('[name="contact[suburb]"]').value = "";
      }

  });

  document.getElementById('new_linked_with_sheets').addEventListener('submit', function(event) {
    event.preventDefault(); 
    
    // Disable submit button
    var submitBtn = this.querySelector('input[type="submit"]');
    var originalValue = submitBtn.value;
    submitBtn.disabled = true;
    submitBtn.value = 'SUBMITTING...';
    
    if ( event.target.closest('form#new_linked_with_sheets').querySelector('[name="contact[order]"]').value == ""){
      event.target.closest('form#new_linked_with_sheets').querySelector('[name="contact[order]"]').value  = "-";
    }
    if( event.target.closest('form#new_linked_with_sheets').querySelector('[name="contact[suburb]"]').value == "") {
      event.target.closest('form#new_linked_with_sheets').querySelector('[name="contact[suburb]"]').value  = "-";
    }

    // Collect form data
    var formData = new FormData(this);
    // Ensure phone is sent under both keys expected by backend
    (function(scope){
      var phoneEl = scope.querySelector('[name="contact[number]"]') || scope.querySelector('[name="contact[phone]"]');
      var phoneVal = phoneEl ? phoneEl.value : '';
      if (phoneVal !== '') {
        formData.set('contact[number]', phoneVal);
        formData.set('contact[phone]', phoneVal);
      }
    })(this);
    console.log(formData);
       for (var [key, value] of formData.entries()) { 
        console.log(key, value);
    }

    // Send form data to Google Apps Script
    {% comment %} old: https://script.google.com/macros/s/AKfycbx5I-nn-c0xfH31FW0oDtT3bVhSoTC9UnB00GGyyZ1p_DVVfaIzOmMhbv-DphgV8FZV/exec {% endcomment %}
    {% comment %} new: https://script.google.com/macros/s/AKfycbz3WvmWHIXtZMHJVx9zpXHkIvKbw5-TLG1QfcanVxj23KXIpe-s1sV3W773ajTI3GJE/exec  {% endcomment %}
    fetch('https://script.google.com/macros/s/AKfycbwmuG8vxiCUpDbH_d4jT9iv4Cyc4pRY02wcrPl9KqvykuPJeoFJXKpnG27gdk9Fnc-P/exec', {
      method: 'POST',
      body: formData, 
    })
    .then(response => {
        console.log(response)
      response.text()})
    .then(data => {
      console.log('Success:', data);
      // Show success message or reset the form
      // Re-enable submit button on success
      submitBtn.disabled = false;
      submitBtn.value = originalValue;
    })
    .catch((error) => {
      console.error('Error:', error);
      // Re-enable submit button on error
      submitBtn.disabled = false;
      submitBtn.value = originalValue;
    });
    return false;
  });
</script>


{% schema %}
{
  "name": "Google contact form",
  "settings": [
    {
      "type": "text",
      "id": "tagline",
      "label": "tagline"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Looking For Premium Screens Solutions?"
    },
    {
      "type": "richtext",
      "id": "subtext",
      "label": "Subtext",
      "default": "<p>Keep bugs out and fresh air in with Ezy Screens — Australia’s go-to for Retractable Fly Screens. Custom or DIY kits available, shipped Australia-wide within two weeks.</p>"
    },
    {
      "type": "image_picker",
      "id": "bg_image",
      "label": "Image"
    }
  ],
  "presets": [
    {
      "name": "Google contact form"
    }
  ]
}
{% endschema %}
